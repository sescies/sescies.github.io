<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>後台</title>
  <!--<meta name="description" content="">-->

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/admin/editor.html">
  <link rel="alternate" type="application/rss+xml" title="SESCies" href="/feed.xml">
  <!--custom css-->
  <link rel="stylesheet" href="/assets/main-style.css">
  <link rel="stylesheet" href="/assets/style.css">
  <link rel="stylesheet" href="/assets/table.css">
  <!--prism-->
  <link rel="stylesheet" href="/assets/prism/prism.css">
  <!--uikit css-->
  <link rel="stylesheet" href="/assets/uikit/css/uikit.min.css">

  <!--jquery-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <!--<script src="/assets/js/jquery-3.1.1.min.js"></script>-->

  <!--uikit javascript-->
  <!--<script src="/assets/uikit/js/uikit.min.js"></script>
  <script src="/assets/uikit/js/uikit-icons.min.js"></script>-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.18/js/uikit.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.0.0-beta.18/js/uikit-icons.min.js"></script>

  
      <!--Editor-->
  <script src="../assets/tinymce/tinymce.min.js"></script>
  <script src="../assets/js/to-markdown.js"></script>
  <script src="../assets/js/marked.js"></script>

  <script>
    tinymce.init({
      mode : "none",
      //selector:'textarea',
      plugins: 'codesample image link table textcolor colorpicker',
      toolbar: "undo redo | formatselect | bold  italic underline | forecolor backcolor | alignleft aligncenter alignright alignjustify alignnone | bullist numlist indent outdent | table | link | image | codesample",
      language: 'zh_TW',
      resize: false,
      height: '350',
    });
  </script>

  

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
</head>


  <body>
    <div id="fb-root"></div>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '276121856143098',
      cookie     : true,
      xfbml      : true,
      version    : 'v2.8'
    });
    FB.AppEvents.logPageView();
    FB.getLoginStatus(function(response) {
      statusChangeCallback(response);
    });
    FB.Event.subscribe('auth.statusChange', function(response) {
      if(response.session){
        statusChangeCallback(response);
       }else{
         statusChangeCallback(response);
       }
     });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/zh_TW/sdk/debug.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>


    <div class="header">
  <div class="uk-container">
    <div class="uk-navbar">
      <div class="uk-navbar-left">
        <a class="site-title" href="/">SESCies</a>
      </div>
      <div class="uk-navbar-right">
        <ul class="uk-navbar-nav">
          <li class="uk-active">
            <div class="fb-login-button" data-max-rows="1" data-size="large" data-show-faces="false" data-auto-logout-link="true"></div>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>


    <div class="content">
      <div class="uk-container">
        <div style="margin-top:20px;">
          <div id="loadingDiv" style="text-align:center;">
            <?xml version="1.0" encoding="utf-8"?><svg width='200px' height='200px' xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-facebook"><rect x="0" y="0" width="100" height="100" fill="#ffffff" class="bk"></rect><g transform="translate(20 50)"><rect x="-10" y="-30" width="20" height="60" fill="#3769c8" opacity="0.6"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g><g transform="translate(50 50)"><rect x="-10" y="-30" width="20" height="60" fill="#3769c8" opacity="0.8"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0.1s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g><g transform="translate(80 50)"><rect x="-10" y="-30" width="20" height="60" fill="#3769c8" opacity="0.9"><animateTransform attributeName="transform" type="scale" from="2" to="1" begin="0.2s" repeatCount="indefinite" dur="1s" calcMode="spline" keySplines="0.1 0.9 0.4 1" keyTimes="0;1" values="2;1"></animateTransform></rect></g></svg>
          </div>
          <div id="context" style="display:none;">

          </div>
        </div>
      </div>
    </div>

    <div class="footer uk-light">
      <div class="uk-container">
        <div style="height:10px;"></div>
        <ul class="uk-subnav uk-subnav-divider">
          <li><a target="_blank" href="#" uk-icon="icon: facebook; ratio: 2"></a></li>
          <li><a target="_blank" href="https://github.com/sescies" uk-icon="icon: github; ratio: 2"></a></li>
        </ul>
        <div class="uk-grid-match uk-child-width-1-2@m" uk-grid>
          <div>
            <h3>關於</h3>
            <ui>
              <li>By Li-Xian Chen @ NIU CSIE</li>
              <li>使用創用CC授權 (By-NC)</li>
              <li>
                <a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-nc/3.0/tw/"><img alt="創用 CC 授權條款" style="border-width:0" src="/assets/images/cc.png" /></a>
              </li>
            </ui>
          </div>

          <div>
            <h3 style="color:#fff;">技術</h3>
            <ui>
              <li>以 <a href="https://jekyllrb.com/" target="_blank">Jekyll</a> 為基底開發</li>
              <li>CSS採用 <a href="https://getuikit.com/" target="_blank">UIkit3</a> 配置</li>
              <li>最低支援至Internet Explorer 10</li>
            </ui>
          </div>
          <div>

          </div>
        </div>
        <br/>
      </div>
    </div>

    <script src="/assets/prism/prism.js"></script>


    <script language="javascript">
  function fbLogin(){
    FB.login(function(response){
      statusChangeCallback(response);
    }, {scope: 'public_profile,email'});
  }

  function fbLogout(){
    FB.logout(function(){
      statusChangeCallback(null);
    });
  }
</script>

    <script language="javascript">
      function statusChangeCallback(response){
        console.log(response);
        if(response !== null && response.status === 'connected'){
          checkUser();
        }else{
          $("#loadingDiv").show();
          window.location.replace("./login.html");
        }
      }

      function getPageName(){
        var url = window.location;
        if (url){
          var m = url.toString().match(/.*\/(.+?)\./);
          if (m && m.length > 1){
            return m[1];
          }
        }
        return "";
      }

      function checkUser(){
        FB.getLoginStatus(function(response) {
          $.ajax({
             url: "https://script.google.com/macros/s/AKfycbwTO6bb061ID-B-rXF4Agxr8qpAcZjLDO0LVKrewfEsZOV1Yd5P/exec",
             type: 'GET',
             data: {
               "token" : response.authResponse.accessToken,
               "action" : "login",
             },
              error: function(xhr) {
                console.error('Ajax request 發生錯誤');
                $('#context').html('<div style="text-align:center;"><h2>伺服器錯誤!</h2><h3>發生錯誤...重新整理試試?</h3></div>');
                $('#loadingDiv').hide();
              },
              success: function(response) {
                var json = JSON.parse(response);
                if(json.isAccepted === true){
                  $('#loadingDiv').hide();
                  $("#context").show();
                }else{
                  window.location.replace("./login.html");
                }
              }
            });
        });
      }

      $(document).ready(function() {
        pjax(getPageName());
      });

      function pjax(page){
        $.ajax({
          xhr: function(){
            var xhr = new window.XMLHttpRequest();
            //Download progress
            xhr.addEventListener("progress", function(evt){
              if (evt.lengthComputable) {
                var percentComplete = evt.loaded / evt.total;
                //Do something with download progress
                console.log("download : "+percentComplete);
              }
            }, false);
            return xhr;
          },
           url: "./pages/" + page,
           type: 'GET',
            error: function(xhr) {
              console.error('Ajax request 發生錯誤');
              $('#context').html('<div style="text-align:center;"><h2>'+xhr.status+'</h2><h3>發生錯誤...重新整理試試?</h3></div>');
              $('#loadingDiv').hide();
            },
            success: function(response) {
              $('#context').html(response);
            }
          });
      }
    </script>
  </body>

</html>

